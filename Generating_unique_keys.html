<!DOCTYPE html>
<html>

<head>
    <meta property="article:published_time" content="2022-12-21T18:34:32.000Z" />
</head>

<body>
    <main>
        <article>
            <section>
                <div class="pw-post-title">
                    <h1>Generating stable unique keys</h1>
                </div>
                <p class="pw-post-body-paragraph">
                    I solved a long-standing problem - generating unique keys for various programs, but in such a way that they are resistant from generation 
                    to generation, meaning that if the package needs to be rebuilt with the same input data, then the resulting keys should be the same.
                </p>
                <p class="pw-post-body-paragraph">
                   Usage example:
                </p>
                <p class="pw-post-body-paragraph">
                    # ix mut system bin/dropbear/runit --seed="dead beef"
                </p>
                <p class="pw-post-body-paragraph">
                    When installing Dropbear (such an alternative to SSH), it wants to generate host keys that should not change for about the lifetime of the installed system.
                </p>
                <p class="pw-post-body-paragraph">
                    It uses random() for this, which does not correspond to the bright idea of "clean build" - the package is a pure function of its inputs 
                    (as a reminder, this is an important condition for the ability to reuse RO packages between different users (not necessarily even on the same host)).
                </p>
                <p class="pw-post-body-paragraph">
                    Actually, the solution to this problem was divided into two parts:
                </p>
                <ul>
                <li>Slightly modify the key generation utility to use a pre-prepared file instead of /dev/random - 
                    <a href="https://github.com/pg83/ix/blob/main/pkgs/bin/dropbear/runit/keygen/ix.sh#L7">https://github.com/pg83/ix/blob/main/pkgs/bin/dropbear/runit/keygen/ix.sh#L7</a>.</li>
                <li>Provide this file to the host key generator and generate these keys. This way, we get a "clean" package that depends only on its seed parameter - 
                    <a href="https://github.com/pg83/ix/blob/main/pkgs/bin/dropbear/runit/hostkeys/ix.sh#L14">https://github.com/pg83/ix/blob/main/pkgs/bin/dropbear/runit/hostkeys/ix.sh#L14</a>.</li>
                </ul>                
                <p class="pw-post-body-paragraph">
                    Thus, we have a kind of "random" set of keys, which is a pure function of seed. The task of the user of the system when setting up the machine 
                    is to specify this seed so that it is unique (this can be done by the installer transparently for the user).
                </p>
                <p class="pw-post-body-paragraph">
                    Actually, the solution to this problem was divided into two parts:
                </p>
                <p class="pw-post-body-paragraph">
                    Actually, the solution to this problem was divided into two parts:
                </p>
                <p class="pw-post-body-paragraph">
                    Actually, the solution to this problem was divided into two parts:
                </p>
          </section>
        </article>
    </main>
</body>

</html>
