<!DOCTYPE html>
<html>

<head>
    <meta property="article:published_time" content="2022-11-21T12:29:36.000Z" />
</head>

<body>
    <main>
        <article>
            <section>
                <div class="pw-post-title">
                    <h1>Tired with <strike>all these</strike> temporary files</h1>
                </div>
                <p class="pw-post-body-paragraph">
                    Today I have a joke for you about my sense of beauty.
                </p>
                <p class="pw-post-body-paragraph">
                   Personally, I hate programs that want to create temporary files. In general, "temporary file" is some nonsense, because why write ephemeral data to a persistent file?
                </p>
                <p class="pw-post-body-paragraph">
                    Data can be buffered in memory or written through a pipe to another program’s input, or something similarly reasonable.
                </p>
                <p class="pw-post-body-paragraph">
                    Usually, programs write something to temporary files as a hack, when some block of code already accepts int fd, and rewriting it to a normal 
                    interface is too lazy, or when some program in the chain does not know how to pipe.
                </p>
                <p class="pw-post-body-paragraph">
                    In the first case, by the way, in modern Linux you can use memfd_create(), which is quite useful in terms of "sweeping garbage under the bed".
                </p>
                <p class="pw-post-body-paragraph">
                    Another problem with temporary files is that various strange programs do not respect the TMPDIR setting and try to write directly to /tmp. 
                    Moreover, they come up with some wild ways of access differentiation and "non-intersection" with other instances.
                </p>
                <p class="pw-post-body-paragraph">
                    Here is the contents of my session tmp:
                </p>
                <p class="pw-post-body-paragraph">
                    ./epiphany-pg-aaNPpb
                    ./d9ca075b14fe84b587843f702e0d2466-
                         {87A94AB0-E370-4cde-98D3-ACC110C5967D}
                    ./6b047d326310867001cb39f5218a36ba-
                         {87A94AB0-E370-4cde-98D3-ACC110C5967D}
                    ./mc-pg
                    ./mc-pg/mc-pg
                    ./sway-ipc.10000.9709.sock
                    ./wayland-1
                    ./wayland-1.lock
                    ./dbus.sock
                    ./dbus-1
                    ./dbus-1/services
                    ./dbus.cfg
                    ./ssh-XXXXXXJIAMlN
                    ./ssh-XXXXXXJIAMlN/agent.9704
                </p>
                <p class="pw-post-body-paragraph">
                    How many different ways of “uniqueness” did you count here?
                </p>
                <p class="pw-post-body-paragraph">
                    I repeat, this infuriates me greatly, and I have set a goal for myself - all the programs that I use should be able to use TMPDIR.
                </p>
                <p class="pw-post-body-paragraph">
                    By the way, a little off topic, TMPDIR should of course be a "complex" path, including user ID and session ID (for example, to effectively clean up 
                    this junk at the end of the session):
                </p>
                <p class="pw-post-body-paragraph">
                    pg->echo ${TMPDIR}
                    /var/tmp/10000/10953
                </p>
                <p class="pw-post-body-paragraph">
                    That’s why I don’t have a root /tmp folder in <a href="https://github.com/stal-ix">stal/IX</a>.  
                </p>
                <p class="pw-post-body-paragraph">
                    Why?
                </p>
                <p class="pw-post-body-paragraph">
                    Because, by a strange coincidence, all programs that have their own strong opinions about the naming of the folder with temporary files try to write to /tmp.<br>
                    And I don’t have it, but I have /var/tmp with session separation.
                </p>
                <p class="pw-post-body-paragraph">
                    Figures on the size of the kernel 
                    <a href="https://www.opennet.ru/opennews/art.shtml?num=57260">https://www.opennet.ru/opennews/art.shtml?num=57260</a>.
                </p>
                <p class="pw-post-body-paragraph">
                    I roughly understand that Linux became normal around version 2.6, with 5-10 MLOC. If we use a proper language, we need to write 
                    somewhere between 0.5-1 MLOC.<br>
                    In general, everything is predictable and very sad.                
                </p>
                <p class="pw-post-body-paragraph">
                    As a result, I decided that most of my problems could be solved by a normal Linux distribution that I understand well and can customize to fit my needs.
                </p>
                <p class="pw-post-body-paragraph">
                    For example, I can create a daemon that kills all orphaned processes inherited by init gradually and incrementally.<br>
                    Additionally, I can abandon dynamic linking and DLL hell as a class of problems.
                </p>
                <p class="pw-post-body-paragraph">
                    To implement these on the same Fedora - it’s easier to kill myself.
                </p>
                <p class="pw-post-body-paragraph">
                    About the overall complexity of the system and how I try to fight with it - well, that's basically what my whole blog is about.
                </p>
                <p class="pw-post-body-paragraph">
                    From all of the above, it follows that:
                </p>
                <ul>
                <li>it is completely pointless to ask me "why not systemd",</li>
                <li>"why not ostree",</li>
                <li>"why …".</li>
                </ul> 
                <p class="pw-post-body-paragraph">
                    I'm trying to solve the problems I know in a different way. This is an exploratory hobby distribution, and not a competitor to RHEL in its field.<br>
                    If I'm satisfied with systemd and DLL hell, I'll choose Fedora and not worry.
                </p>
                <p class="pw-post-body-paragraph">
                    But I am interested in "how, in general, can it be done differently."                
                </p>
                
          </section>
        </article>
    </main>
</body>

</html>
